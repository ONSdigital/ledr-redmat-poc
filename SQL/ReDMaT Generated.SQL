/*
CREATED: 01/05/2018
MODIFIED: 17/05/2018
PROJECT: REFERENCE DATA MANAGEMENT TOOL
MODEL: ORACLE 12C
AUTHOR: PETER MILLER
VERSION: 0.1
DATABASE: ORACLE 12C
*/


-- DROP RELATIONSHIPS SECTION -------------------------------------------------

ALTER TABLE REDMAT_ACTIVITY_LOG DROP CONSTRAINT PERFORMED
/
ALTER TABLE REDMAT_ACTIVITY_LOG DROP CONSTRAINT BY WHOM
/
ALTER TABLE REFERENCE_DATA_LOAD_LOG DROP CONSTRAINT DETAILS
/
ALTER TABLE REDMAT_ENVIRONMENT DROP CONSTRAINT SOURCE FOR
/
ALTER TABLE REDMAT_ENVIRONMENT DROP CONSTRAINT HOSTS
/
ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA DROP CONSTRAINT IMPLEMENTATION
/
ALTER TABLE SCHEMA_REFERENCE_DATA_INSTANCE DROP CONSTRAINT CONSISTS OF
/
ALTER TABLE SCHEMA_REFERENCE_DATA_INSTANCE DROP CONSTRAINT INSTANCE OF
/
ALTER TABLE REDMAT_ENVIRONMENT_USER_ROLE DROP CONSTRAINT PERFORMS
/
ALTER TABLE REDMAT_ENVIRONMENT_USER_ROLE DROP CONSTRAINT MANAGED BY
/
ALTER TABLE REDMAT_ENVIRONMENT_USER_ROLE DROP CONSTRAINT SUPPORTS
/
ALTER TABLE REDMAT_ROLE_PERMISSION DROP CONSTRAINT ALLOWS
/
ALTER TABLE REDMAT_ROLE_PERMISSION DROP CONSTRAINT GRANTED
/
ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA DROP CONSTRAINT COPY
/
ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA DROP CONSTRAINT VIEW
/
ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA DROP CONSTRAINT REALISES
/
ALTER TABLE REDMAT_SCHEMA DROP CONSTRAINT CONTAINS
/




-- DROP KEYS FOR TABLES SECTION -------------------------------------------------

ALTER TABLE REDMAT_ACTIVITY_LOG DROP CONSTRAINT KEY15
/
ALTER TABLE REFERENCE_DATA_LOAD_LOG DROP CONSTRAINT KEY14
/
ALTER TABLE REDMAT_DATABASE DROP CONSTRAINT KEY13
/
ALTER TABLE REDMAT_DATABASE DROP CONSTRAINT DATABASE_ID
/
ALTER TABLE REDMAT_ROLE_PERMISSION DROP CONSTRAINT KEY12
/
ALTER TABLE REDMAT_PERMISSION DROP CONSTRAINT KEY11
/
ALTER TABLE REDMAT_PERMISSION DROP CONSTRAINT ID
/
ALTER TABLE SCHEMA_REFERENCE_DATA_INSTANCE DROP CONSTRAINT KEY10
/
ALTER TABLE REFERENCE_DATA DROP CONSTRAINT KEY9
/
ALTER TABLE REFERENCE_DATA DROP CONSTRAINT FILE_ID
/
ALTER TABLE REFERENCE_DATA DROP CONSTRAINT TABLE_NAME
/
ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA DROP CONSTRAINT KEY8
/
ALTER TABLE REDMAT_ENVIRONMENT_USER_ROLE DROP CONSTRAINT KEY6
/
ALTER TABLE REDMAT_ROLE DROP CONSTRAINT KEY4
/
ALTER TABLE REDMAT_ROLE DROP CONSTRAINT ID
/
ALTER TABLE REDMAT_USER DROP CONSTRAINT USER_ID_PK
/
ALTER TABLE REDMAT_USER DROP CONSTRAINT USER_ID
/
ALTER TABLE REDMAT_SCHEMA DROP CONSTRAINT KEY2
/
ALTER TABLE REDMAT_SCHEMA DROP CONSTRAINT ID
/
ALTER TABLE REDMAT_ENVIRONMENT DROP CONSTRAINT KEY1
/
ALTER TABLE REDMAT_ENVIRONMENT DROP CONSTRAINT ID
/





-- DROP TABLES SECTION ---------------------------------------------------

DROP TABLE REDMAT_ACTIVITY_LOG CASCADE CONSTRAINTS
/
DROP TABLE REFERENCE_DATA_LOAD_LOG CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_DATABASE CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_ROLE_PERMISSION CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_PERMISSION CASCADE CONSTRAINTS
/
DROP TABLE SCHEMA_REFERENCE_DATA_INSTANCE CASCADE CONSTRAINTS
/
DROP TABLE REFERENCE_DATA CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_SCHEMA_REFERENCE_DATA CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_ENVIRONMENT_USER_ROLE CASCADE CONSTRAINTS
/
DROP TABLE DATABASE CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_ROLE CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_USER CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_SCHEMA CASCADE CONSTRAINTS
/
DROP TABLE REDMAT_ENVIRONMENT CASCADE CONSTRAINTS
/

-- CREATE TABLES SECTION -------------------------------------------------

-- TABLE REDMAT_ENVIRONMENT

CREATE TABLE REDMAT_ENVIRONMENT(
  ENVIRONMENT_ID VARCHAR2(32 ) NOT NULL,
  DATABASE_ID VARCHAR2(32 ) NOT NULL,
  DESCRIPTION VARCHAR2(256 ) NOT NULL,
  ENVIRONMENT_TYPE VARCHAR2(32 ) NOT NULL,
  DEFAULT_SOURCE_ID VARCHAR2(32 )
)
/

-- ADD KEYS FOR TABLE REDMAT_ENVIRONMENT

ALTER TABLE REDMAT_ENVIRONMENT ADD CONSTRAINT KEY1 PRIMARY KEY (ENVIRONMENT_ID)
/

ALTER TABLE REDMAT_ENVIRONMENT ADD CONSTRAINT ID UNIQUE (ENVIRONMENT_ID)
/

-- TABLE REDMAT_SCHEMA

CREATE TABLE REDMAT_SCHEMA(
  SCHEMA_ID VARCHAR2(32 ) NOT NULL,
  ENVIRONMENT_ID VARCHAR2(32 ) NOT NULL,
  DESCRIPTION VARCHAR2(256 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE REDMAT_SCHEMA

ALTER TABLE REDMAT_SCHEMA ADD CONSTRAINT KEY2 PRIMARY KEY (SCHEMA_ID)
/

ALTER TABLE REDMAT_SCHEMA ADD CONSTRAINT ID UNIQUE (SCHEMA_ID)
/

-- TABLE REDMAT_USER

CREATE TABLE REDMAT_USER(
  USER_ID VARCHAR2(32 ) NOT NULL,
  DESCRIPTION VARCHAR2(256 ) NOT NULL,
  PASSWORD VARCHAR2(16 )
)
/

-- ADD KEYS FOR TABLE REDMAT_USER

ALTER TABLE REDMAT_USER ADD CONSTRAINT USER_ID_PK PRIMARY KEY (USER_ID)
/

ALTER TABLE REDMAT_USER ADD CONSTRAINT USER_ID UNIQUE (USER_ID)
/

-- TABLE REDMAT_ROLE

CREATE TABLE REDMAT_ROLE(
  ROLE_ID VARCHAR2(32 ) NOT NULL,
  DESCRIPTION VARCHAR2(256 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE REDMAT_ROLE

ALTER TABLE REDMAT_ROLE ADD CONSTRAINT KEY4 PRIMARY KEY (ROLE_ID)
/

ALTER TABLE REDMAT_ROLE ADD CONSTRAINT ID UNIQUE (ROLE_ID)
/

-- TABLE DATABASE

CREATE TABLE DATABASE(
)
/

-- TABLE REDMAT_ENVIRONMENT_USER_ROLE

CREATE TABLE REDMAT_ENVIRONMENT_USER_ROLE(
  USER_ID VARCHAR2(32 ) NOT NULL,
  ROLE_ID VARCHAR2(32 ) NOT NULL,
  ENVIRONMENT_ID VARCHAR2(32 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE REDMAT_ENVIRONMENT_USER_ROLE

ALTER TABLE REDMAT_ENVIRONMENT_USER_ROLE ADD CONSTRAINT KEY6 PRIMARY KEY (USER_ID,ROLE_ID,ENVIRONMENT_ID)
/

-- TABLE REDMAT_SCHEMA_REFERENCE_DATA

CREATE TABLE REDMAT_SCHEMA_REFERENCE_DATA(
  SCHEMA_ID VARCHAR2(32 ) NOT NULL,
  FILE_ID NUMBER NOT NULL,
  STATUS VARCHAR2(32 ) NOT NULL,
  LAST_ACTIVITY_DATE DATE NOT NULL,
  VIEW_OF_SCHEMA_ID VARCHAR2(32 ),
  COPY_FROM_SCHEMA_ID VARCHAR2(32 )
)
/

-- ADD KEYS FOR TABLE REDMAT_SCHEMA_REFERENCE_DATA

ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA ADD CONSTRAINT KEY8 PRIMARY KEY (SCHEMA_ID,FILE_ID)
/

-- TABLE REFERENCE_DATA

CREATE TABLE REFERENCE_DATA(
  FILE_ID NUMBER NOT NULL,
  DESCRIPTION VARCHAR2(100 ) NOT NULL,
  TABLE_NAME VARCHAR2(32 ) NOT NULL,
  SAY_SA_NAME CHAR(20 )
)
/

-- ADD KEYS FOR TABLE REFERENCE_DATA

ALTER TABLE REFERENCE_DATA ADD CONSTRAINT KEY9 PRIMARY KEY (FILE_ID)
/

ALTER TABLE REFERENCE_DATA ADD CONSTRAINT FILE_ID UNIQUE (FILE_ID)
/

ALTER TABLE REFERENCE_DATA ADD CONSTRAINT TABLE_NAME UNIQUE (TABLE_NAME)
/

-- TABLE SCHEMA_REFERENCE_DATA_INSTANCE

CREATE TABLE SCHEMA_REFERENCE_DATA_INSTANCE(
  SCHEMA_ID VARCHAR2(32 ) NOT NULL,
  FILE_ID NUMBER NOT NULL,
  INSTANCE_ID NUMBER NOT NULL,
  EFFECTIVE_FROM DATE NOT NULL,
  EFFECTIVE_TO DATE NOT NULL,
  VERSION_TEXT VARCHAR2(100 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE SCHEMA_REFERENCE_DATA_INSTANCE

ALTER TABLE SCHEMA_REFERENCE_DATA_INSTANCE ADD CONSTRAINT KEY10 PRIMARY KEY (INSTANCE_ID,SCHEMA_ID,FILE_ID)
/

-- TABLE REDMAT_PERMISSION

CREATE TABLE REDMAT_PERMISSION(
  PERMISSION_ID VARCHAR2(32 ) NOT NULL,
  DESCRIPTION VARCHAR2(256 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE REDMAT_PERMISSION

ALTER TABLE REDMAT_PERMISSION ADD CONSTRAINT KEY11 PRIMARY KEY (PERMISSION_ID)
/

ALTER TABLE REDMAT_PERMISSION ADD CONSTRAINT ID UNIQUE (PERMISSION_ID)
/

-- TABLE REDMAT_ROLE_PERMISSION

CREATE TABLE REDMAT_ROLE_PERMISSION(
  ROLE_ID VARCHAR2(32 ) NOT NULL,
  PERMISSION_ID VARCHAR2(32 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE REDMAT_ROLE_PERMISSION

ALTER TABLE REDMAT_ROLE_PERMISSION ADD CONSTRAINT KEY12 PRIMARY KEY (PERMISSION_ID,ROLE_ID)
/

-- TABLE REDMAT_DATABASE

CREATE TABLE REDMAT_DATABASE(
  DATABASE_ID VARCHAR2(32 ) NOT NULL,
  DESCRIPTION VARCHAR2(256 ) NOT NULL
)
/

-- ADD KEYS FOR TABLE REDMAT_DATABASE

ALTER TABLE REDMAT_DATABASE ADD CONSTRAINT KEY13 PRIMARY KEY (DATABASE_ID)
/

ALTER TABLE REDMAT_DATABASE ADD CONSTRAINT DATABASE_ID UNIQUE (DATABASE_ID)
/

-- TABLE REFERENCE_DATA_LOAD_LOG

CREATE TABLE REFERENCE_DATA_LOAD_LOG(
  SCHEMA_ID VARCHAR2(32 ) NOT NULL,
  FILE_ID NUMBER NOT NULL,
  INSTANCE_ID NUMBER NOT NULL,
  FILE_NAME VARCHAR2(256 ) NOT NULL,
  VERSION_TEXT VARCHAR2(256 ) NOT NULL,
  EFFECTIVE_FROM DATE NOT NULL,
  RECORDS_LOADED NUMBER NOT NULL,
  USER_ID VARCHAR2(64 ) NOT NULL,
  USER_EMAIL VARCHAR2(128 ) NOT NULL,
  PSU_STATUS_ID NUMBER NOT NULL,
  STARTED DATE NOT NULL,
  ENDED DATE
)
/

-- ADD KEYS FOR TABLE REFERENCE_DATA_LOAD_LOG

ALTER TABLE REFERENCE_DATA_LOAD_LOG ADD CONSTRAINT KEY14 PRIMARY KEY (INSTANCE_ID,SCHEMA_ID,FILE_ID)
/

-- TABLE REDMAT_ACTIVITY_LOG

CREATE TABLE REDMAT_ACTIVITY_LOG(
  USER_ID VARCHAR2(32 ) NOT NULL,
  PERMISSION_ID VARCHAR2(32 ) NOT NULL,
  TIMESTAMP DATE NOT NULL,
  INFORMATION VARCHAR2(2000 )
)
/

-- ADD KEYS FOR TABLE REDMAT_ACTIVITY_LOG

ALTER TABLE REDMAT_ACTIVITY_LOG ADD CONSTRAINT KEY15 PRIMARY KEY (PERMISSION_ID,USER_ID)
/

-- CREATE RELATIONSHIPS SECTION ------------------------------------------------- 

ALTER TABLE REDMAT_SCHEMA ADD CONSTRAINT CONTAINS FOREIGN KEY (ENVIRONMENT_ID) REFERENCES REDMAT_ENVIRONMENT (ENVIRONMENT_ID)
/

ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA ADD CONSTRAINT REALISES FOREIGN KEY (SCHEMA_ID) REFERENCES REDMAT_SCHEMA (SCHEMA_ID)
/

ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA ADD CONSTRAINT VIEW FOREIGN KEY (VIEW_OF_SCHEMA_ID) REFERENCES REDMAT_SCHEMA (SCHEMA_ID)
/

ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA ADD CONSTRAINT COPY FOREIGN KEY (COPY_FROM_SCHEMA_ID) REFERENCES REDMAT_SCHEMA (SCHEMA_ID)
/

ALTER TABLE REDMAT_ROLE_PERMISSION ADD CONSTRAINT GRANTED FOREIGN KEY (ROLE_ID) REFERENCES REDMAT_ROLE (ROLE_ID)
/

ALTER TABLE REDMAT_ROLE_PERMISSION ADD CONSTRAINT ALLOWS FOREIGN KEY (PERMISSION_ID) REFERENCES REDMAT_PERMISSION (PERMISSION_ID)
/

ALTER TABLE REDMAT_ENVIRONMENT_USER_ROLE ADD CONSTRAINT SUPPORTS FOREIGN KEY (USER_ID) REFERENCES REDMAT_USER (USER_ID)
/

ALTER TABLE REDMAT_ENVIRONMENT_USER_ROLE ADD CONSTRAINT MANAGED BY FOREIGN KEY (ENVIRONMENT_ID) REFERENCES REDMAT_ENVIRONMENT (ENVIRONMENT_ID)
/

ALTER TABLE REDMAT_ENVIRONMENT_USER_ROLE ADD CONSTRAINT PERFORMS FOREIGN KEY (ROLE_ID) REFERENCES REDMAT_ROLE (ROLE_ID)
/

ALTER TABLE SCHEMA_REFERENCE_DATA_INSTANCE ADD CONSTRAINT INSTANCE OF FOREIGN KEY (FILE_ID) REFERENCES REFERENCE_DATA (FILE_ID)
/

ALTER TABLE SCHEMA_REFERENCE_DATA_INSTANCE ADD CONSTRAINT CONSISTS OF FOREIGN KEY (SCHEMA_ID) REFERENCES REDMAT_SCHEMA (SCHEMA_ID)
/

ALTER TABLE REDMAT_SCHEMA_REFERENCE_DATA ADD CONSTRAINT IMPLEMENTATION FOREIGN KEY (FILE_ID) REFERENCES REFERENCE_DATA (FILE_ID)
/

ALTER TABLE REDMAT_ENVIRONMENT ADD CONSTRAINT HOSTS FOREIGN KEY (DATABASE_ID) REFERENCES REDMAT_DATABASE (DATABASE_ID)
/

ALTER TABLE REDMAT_ENVIRONMENT ADD CONSTRAINT SOURCE FOR FOREIGN KEY (DEFAULT_SOURCE_ID) REFERENCES REDMAT_ENVIRONMENT (ENVIRONMENT_ID)
/

ALTER TABLE REFERENCE_DATA_LOAD_LOG ADD CONSTRAINT DETAILS FOREIGN KEY (INSTANCE_ID, SCHEMA_ID, FILE_ID) REFERENCES SCHEMA_REFERENCE_DATA_INSTANCE (INSTANCE_ID, SCHEMA_ID, FILE_ID)
/

ALTER TABLE REDMAT_ACTIVITY_LOG ADD CONSTRAINT BY WHOM FOREIGN KEY (USER_ID) REFERENCES REDMAT_USER (USER_ID)
/

ALTER TABLE REDMAT_ACTIVITY_LOG ADD CONSTRAINT PERFORMED FOREIGN KEY (PERMISSION_ID) REFERENCES REDMAT_PERMISSION (PERMISSION_ID)
/

